<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Careem Payout Tracker - Fixed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f6f8;
      color: #333;
    }
    header {
      background-color: #2c3e50;
      color: #fff;
      padding: 15px;
      text-align: center;
    }
    h1 {
      margin: 0;
      font-size: 24px;
    }
    .container {
      padding: 20px;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .tabs button {
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      background: #34495e;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    .tabs button.active, .tabs button:hover {
      background: #1abc9c;
    }
    .view {
      display: none;
    }
    .view.active {
      display: block;
    }
    .filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    .filters input, .filters select {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .table-container {
      overflow-x: auto;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }
    th, td {
      border: 1px solid #e1e1e1;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #ecf0f1;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    .total-bar {
      margin-top: 15px;
      padding: 10px;
      background: #dff9fb;
      border-radius: 6px;
      font-weight: bold;
    }
    .export-buttons {
      margin-top: 10px;
    }
    .export-buttons button {
      margin-right: 10px;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #3498db;
      color: white;
    }
    .export-buttons button:hover {
      background: #2980b9;
    }
    @media (max-width: 768px) {
      .filters {
        flex-direction: column;
      }
      table {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Weekly Careem Payout Tracker</h1>
</header>

<div class="container">
  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" onclick="switchView('dashboard')">Dashboard</button>
    <button class="tab-btn" onclick="switchView('weekly')">Weekly View</button>
    <button class="tab-btn" onclick="switchView('reports')">Reports</button>
  </div>

  <!-- Dashboard View -->
  <div id="dashboard" class="view active">
    <h2>Dashboard Overview</h2>
    <div class="filters">
      <input type="text" id="searchDashboard" placeholder="Search..." onkeyup="searchData('dashboardTable', this.value)">
      <select id="branchFilter" onchange="filterData('dashboardTable', this.value)">
        <option value="">All Branches</option>
        <option value="Hamdan">Hamdan</option>
        <option value="Khaldia">Khaldia</option>
        <option value="Shabiya 11">Shabiya 11</option>
        <option value="Muroor">Muroor</option>
        <option value="Al Electra">Al Electra</option>
      </select>
    </div>
    <div class="table-container">
      <table id="dashboardTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Branch</th>
            <th>Date</th>
            <th>Billable ID</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1001</td><td>Hamdan</td><td>2025-09-15</td><td>B101</td><td>120</td></tr>
          <tr><td>1002</td><td>Khaldia</td><td>2025-09-16</td><td>B102</td><td>95</td></tr>
          <tr><td>1003</td><td>Shabiya 11</td><td>2025-09-16</td><td>B103</td><td>140</td></tr>
          <tr><td>1004</td><td>Muroor</td><td>2025-09-17</td><td>B104</td><td>200</td></tr>
          <tr><td>1005</td><td>Al Electra</td><td>2025-09-18</td><td>B105</td><td>80</td></tr>
        </tbody>
      </table>
    </div>
    <div class="total-bar" id="dashboardTotal">Total: 0</div>
    <div class="export-buttons">
      <button onclick="exportCSV('dashboardTable')">Export CSV</button>
      <button onclick="printTable('dashboardTable')">Print</button>
    </div>
  </div>

  <!-- Weekly View -->
  <div id="weekly" class="view">
    <h2>Weekly View</h2>
    <div class="filters">
      <button onclick="prevWeek()">⬅ Prev Week</button>
      <span id="weekLabel">Week of 2025-09-15</span>
      <button onclick="nextWeek()">Next Week ➡</button>
    </div>
    <div class="table-container">
      <table id="weeklyTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Branch</th>
            <th>Date</th>
            <th>Billable ID</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          <!-- Auto filled from dashboard -->
        </tbody>
      </table>
    </div>
    <div class="total-bar" id="weeklyTotal">Total: 0</div>
  </div>

  <!-- Reports View -->
  <div id="reports" class="view">
    <h2>Reports</h2>
    <div class="table-container">
      <table id="reportsTable">
        <thead>
          <tr>
            <th>Branch</th>
            <th>Total Orders</th>
            <th>Total Amount</th>
            <th>Average Amount</th>
          </tr>
        </thead>
        <tbody>
          <!-- Calculated dynamically -->
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
  // Switch views
  function switchView(viewId) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById(viewId).classList.add('active');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    if(viewId === 'dashboard') calculateTotal('dashboardTable', 'dashboardTotal');
    if(viewId === 'weekly') loadWeekly();
    if(viewId === 'reports') loadReports();
  }

  // Search function
  function searchData(tableId, query) {
    let table = document.getElementById(tableId);
    let rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(query.toLowerCase()) ? '' : 'none';
    });
    calculateTotal(tableId, tableId.replace('Table','Total'));
  }

  // Filter by branch
  function filterData(tableId, branch) {
    let table = document.getElementById(tableId);
    let rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
      row.style.display = (!branch || row.cells[1].innerText === branch) ? '' : 'none';
    });
    calculateTotal(tableId, tableId.replace('Table','Total'));
  }

  // Calculate totals
  function calculateTotal(tableId, totalId) {
    let table = document.getElementById(tableId);
    let rows = table.querySelectorAll('tbody tr');
    let total = 0;
    rows.forEach(row => {
      if(row.style.display !== 'none') {
        total += parseFloat(row.cells[4].innerText || 0);
      }
    });
    document.getElementById(totalId).innerText = "Total: " + total.toFixed(2);
  }

  // Export CSV
  function exportCSV(tableId) {
    let table = document.getElementById(tableId);
    let rows = table.querySelectorAll('tr');
    let csv = [];
    rows.forEach(row => {
      let cols = row.querySelectorAll('th,td');
      let data = [];
      cols.forEach(c => data.push(c.innerText));
      csv.push(data.join(","));
    });
    let blob = new Blob([csv.join("\n")], {type: "text/csv"});
    let url = window.URL.createObjectURL(blob);
    let a = document.createElement("a");
    a.href = url;
    a.download = tableId+".csv";
    a.click();
  }

  // Print table
  function printTable(tableId) {
    let table = document.getElementById(tableId).outerHTML;
    let w = window.open("");
    w.document.write("<html><head><title>Print</title></head><body>");
    w.document.write(table);
    w.document.write("</body></html>");
    w.print();
  }

  // Weekly navigation
  let currentWeek = new Date("2025-09-15");
  function formatDate(d) {
    return d.toISOString().split('T')[0];
  }
  function prevWeek() {
    currentWeek.setDate(currentWeek.getDate() - 7);
    loadWeekly();
  }
  function nextWeek() {
    currentWeek.setDate(currentWeek.getDate() + 7);
    loadWeekly();
  }
  function loadWeekly() {
    let start = new Date(currentWeek);
    let end = new Date(currentWeek);
    end.setDate(start.getDate() + 6);
    document.getElementById('weekLabel').innerText = "Week of " + formatDate(start);
    let rows = document.querySelectorAll('#dashboardTable tbody tr');
    let weeklyBody = document.querySelector('#weeklyTable tbody');
    weeklyBody.innerHTML = "";
    rows.forEach(r => {
      let d = new Date(r.cells[2].innerText);
      if(d >= start && d <= end) {
        weeklyBody.appendChild(r.cloneNode(true));
      }
    });
    calculateTotal('weeklyTable','weeklyTotal');
  }

  // Reports
  function loadReports() {
    let rows = document.querySelectorAll('#dashboardTable tbody tr');
    let data = {};
    rows.forEach(r => {
      let branch = r.cells[1].innerText;
      let amount = parseFloat(r.cells[4].innerText);
      if(!data[branch]) data[branch] = {count:0, total:0};
      data[branch].count++;
      data[branch].total += amount;
    });
    let body = document.querySelector('#reportsTable tbody');
    body.innerHTML = "";
    for(let branch in data) {
      let tr = document.createElement('tr');
      tr.innerHTML = `<td>${branch}</td>
                      <td>${data[branch].count}</td>
                      <td>${data[branch].total.toFixed(2)}</td>
                      <td>${(data[branch].total/data[branch].count).toFixed(2)}</td>`;
      body.appendChild(tr);
    }
  }

  // Init
  window.onload = () => {
    calculateTotal('dashboardTable','dashboardTotal');
  };
</script>

</body>
</html>
